<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SyncDancer</title>
</head>
<body style="margin: 0; height: 100%; width: 100%">
<h1 id="count">1</h1>
<button onclick="doubleTime()">Double Time!</button>
<button onclick="halfTime()">Half Time!</button>
<script src="./VideoTime.js"></script>
<script src="./Tapper.js"></script>
<script src="./libgif.js"></script>
<script>
    let videos = [];

    function loadGif(url) {
        const element = document.createElement('img');
        document.body.append(element);
        const beats = url.split('_').pop().split('.')[0];
        element.src = url;
        const sg = new SuperGif({gif: element});
        sg.load(() => {
            sg.pause();

            videos.push(new VideoTime(element, 11, sg.get_length(), beats, vT => {
                const frame = (vT.offset + vT.fraction * vT.loopLength) % sg.get_length();
                sg.move_to(frame);
            }));
        });

        return element;
    }
    loadGif('./Loop%20Videos/triangle_4.gif');
    loadGif('./Loop%20Videos/duck_32.gif');

    const count = document.getElementById('count');

    const tapper = new Tapper();

    document.addEventListener('keydown', ev => {
        tapper.tap(ev.timeStamp);
    });

    function doubleTime() {
        tapper.multiply(0.5);
    }
    function halfTime() {
        tapper.multiply(2);
    }

    function update(time) {
        const nextBeat = tapper.whenNextBeat(time);
        for (let v of videos) {
            v.update(time, tapper.lastBeat, nextBeat);
            count.innerText = `${tapper.bpm()}BPM`;
        }
        requestAnimationFrame(update);
    }

    requestAnimationFrame(update);
</script>

</body>
</html>