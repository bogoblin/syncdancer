<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SyncDancer</title>
</head>
<body style="margin: 0; height: 100%; width: 100%">
<video style="width: 100%" id="main-video" src="./Loop%20Videos/triangle_4.mp4" muted></video>
<h1 id="count">1</h1>
<button onclick="doubleTime()">Double Time!</button>
<button onclick="halfTime()">Half Time!</button>
<script src="./VideoTime.js"></script>
<script src="./Tapper.js"></script>
<script>
    const video = document.getElementById('main-video');
    const count = document.getElementById('count');

    const tapper = new Tapper();

    let videos = [];
    video.onloadeddata = () => {
        videos.push(new VideoTime(video, 0, video.duration, 4));
        video.muted = true;
        video.preservesPitch = false;
        video.playbackRate = 0;
    }

    document.addEventListener('keydown', ev => {
        tapper.tap(ev.timeStamp);
    });

    function doubleTime() {
        tapper.multiply(0.5);
    }
    function halfTime() {
        tapper.multiply(2);
    }

    function update(time) {
        const nextBeat = tapper.whenNextBeat(time);
        for (let v of videos) {
            v.update(time, nextBeat);
            count.innerText = v.beat();
        }
        requestAnimationFrame(update);
    }

    requestAnimationFrame(update);
</script>

</body>
</html>