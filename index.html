<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>SyncDancer</title>
</head>
<body style="margin: 0; height: 100%; width: 100%">
<video style="width: 100%" id="main-video" src="./Loop%20Videos/triangle_4.mp4" muted></video>
<h1 id="count">1</h1>
<button onclick="doubleTime()">Double Time!</button>
<button onclick="halfTime()">Half Time!</button>
<script src="./VideoTime.js"></script>
<script src="./Tapper.js"></script>
<script>
    const video = document.getElementById('main-video');
    const count = document.getElementById('count');

    let videoTime;
    video.onloadeddata = () => {
        videoTime = new VideoTime(video, 0, 4);
        video.muted = true;
        video.preservesPitch = false;
        video.playbackRate = 0;
        doFrame();
    }

    const tapper = new Tapper();

    document.addEventListener('keydown', () => {
        tapper.tap();
        update();
    });

    function doFrame() {
        requestAnimationFrame((t) => {
            doFrame();
            video.currentTime = videoTime.timeToVideoTime(t);
            count.innerText = `${videoTime.beat(t)}`;
        });
    }

    function doubleTime() {
        tapper.multiply(0.5);
        update();
    }
    function halfTime() {
        tapper.multiply(2);
        update();
    }

    function update() {
        const start = tapper.one();
        const msPerBeat = tapper.averageTimeBetweenTaps();
        videoTime.setStartAndTime(start, msPerBeat);
    }
</script>

</body>
</html>